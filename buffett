#!/bin/bash

# Aktuelles Verzeichnis speichern
ORIGINAL_DIR=$(pwd)

# Arbeitsverzeichnis festlegen
WORK_DIR="$HOME/Dbtspace/buffett"

# Prüfen, ob das Verzeichnis existiert
if [ ! -d "$WORK_DIR" ]; then
    echo "error: directory $WORK_DIR does not exist."
    cd "$ORIGINAL_DIR"  # Zurück zum Ausgangsordner
    exit 1
fi

# In das Arbeitsverzeichnis wechseln
cd "$WORK_DIR" || {
    echo "error: could not change into $WORK_DIR."
    cd "$ORIGINAL_DIR"  # Zurück zum Ausgangsordner
    exit 1
}

# Standardwerte
IMAGE="buffett-duckdb:latest"
HOST_DIR="$WORK_DIR"
CONTAINER_DIR="/app"

# Docker-Befehl ausführen
docker run -it \
    -v "$HOST_DIR/data:$CONTAINER_DIR/data" \
    -v "$HOST_DIR/database:$CONTAINER_DIR/database" \
    -v "$HOST_DIR/logs:$CONTAINER_DIR/logs" \
    -v "$HOST_DIR/dashboard:$CONTAINER_DIR/dashboard" \
    --user "$(id -u):$(id -g)" \
    "$IMAGE"

# Fehlerprüfung
EXIT_CODE=$?
if [ $EXIT_CODE -eq 0 ]; then
    echo "buffett completed without (visible) errors."
else
    echo "buffett encountered an error (exit code: $EXIT_CODE)."
fi

# Zurück zum ursprünglichen Verzeichnis
cd "$ORIGINAL_DIR" || {
    echo "warning: could not change the working directory to $ORIGINAL_DIR."
    exit 1
}

exit $EXIT_CODE
